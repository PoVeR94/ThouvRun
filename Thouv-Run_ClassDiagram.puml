@startuml Thouv-Run Class Diagram
!theme vibrant

' ========== CLASSES PRINCIPALES ==========

class Entite {
    - x: float
    - y: float
    - width: int
    - height: int
    - type: string
    - art: string[]
    
    + rect_collision(autre: Entite): bool
    + update(): void
}

class Thouverez extends Entite {
    - is_jumping: bool
    - jump_vel: float
    
    + sauter_court(): void
    + sauter_long(): void
    + update(): void
}

class Jeu {
    - joueur: Thouverez
    - obstacles: list<Entite>
    - bonus: list<Entite>
    - score: float
    - distance: float
    - bedos: int
    - vitesse: float
    - running: bool
    - difficulte: string
    - nom_joueur: string
    - timer_spawn: int
    
    + __init__(nom, version, difficulte): void
    + update(): void
    + fin_partie(cause): void
}

class GestionnaireMusique {
    - titre_actuel: string
    - fichier_actuel: string
    - volume: float
    
    + demarrer_ambiance_menu(): void
    + demarrer_ambiance_jeu(): void
    + jouer_saut(): void
    + jouer_bedo(): void
    + jouer_police(): void
    + definir_volume(pct): void
}

class GestionScores {
    + charger_scores(): list<dict>
    + sauvegarder_nouveau_score(...): void
    + synchroniser_scores_depuis_serveur(): void
    + recuperer_records(joueur): tuple<int, int>
    + recuperer_meilleurs_scores(limit): list<dict>
    - _envoyer_score_api(score): void
    - _telecharger_scores_api(): list<dict>
    - _synchroniser_backup(): void
}

class UIGraphique {
    + dessiner_menu(): void
    + dessiner_setup(): void
    + dessiner_tuto(): void
    + dessiner_jeu(): void
    + dessiner_gameover(): void
}

class UITerminal {
    + dessiner_menu(): void
    + dessiner_jeu(): void
    + dessiner_gameover(): void
}

class APIServeur {
    + POST /api/scores: void
    + GET /api/scores: list<dict>
    + GET /api/stats: dict
}

class Leaderboard {
    - scores: list<dict>
    + charger_scores(): void
    + filtrer_par_nom(query): list<dict>
    + trier_par(champ, ordre): void
    + afficher_tableau(): void
}

' ========== ASSOCIATIONS ==========

Jeu --> Thouverez : possède
Jeu --> Entite : contient (obstacles)
Jeu --> Entite : contient (bonus)

Jeu --> GestionScores : utilise
Jeu --> GestionnaireMusique : utilise

UIGraphique --> Jeu : utilise
UIGraphique --> GestionnaireMusique : utilise

UITerminal --> Jeu : utilise
UITerminal --> GestionnaireMusique : utilise

APIServeur --> GestionScores : synchronise
APIServeur --> Leaderboard : fournit les données

Leaderboard --> APIServeur : récupère les scores

' ========== NOTES ==========

note right of Entite
    Classe parent pour tous
    les objets du jeu.
    Gère les collisions AABB.
end note

note right of Thouverez
    Représente le joueur.
    Gère les sauts (court/long)
    et la détection du sol.
end note

note right of Jeu
    Moteur central du jeu.
    Logique pure, pas de GUI.
    Responsable de :
    - Physique & collisions
    - Génération obstacles
    - Calcul du score
    - Sauvegarde du score
end note

note right of GestionScores
    Gère la persistance des scores.
    Couches : Local (JSON) +
    Serveur (API) + Sync automatique
end note

note right of GestionnaireMusique
    Thread dédié pour :
    - Musiques de fond
    - Effets sonores
    - Gestion du volume
end note

note bottom of UIGraphique
    Pygame 2.5.2
    Résolution: 1600x900
    Responsive avec fullscreen
end note

note bottom of UITerminal
    windows-curses
    Mode ASCII art
    Compatible telnet/SSH
end note

note bottom of APIServeur
    Flask 3.0.0 + CORS
    Déployé sur Railway.app
    Base SQLite éphémère
end note

note bottom of Leaderboard
    HTML5 + CSS3 + Vanilla JS
    191 scores (dedupliqués)
    Recherche et tri temps réel
    Mise à jour auto (10s)
end note

' ========== STRUCTURE ARCHITECTURE ==========

package "Game Engine" {
    Entite
    Thouverez
    Jeu
}

package "User Interface" {
    UIGraphique
    UITerminal
    GestionnaireMusique
}

package "Persistence" {
    GestionScores
}

package "Backend" {
    APIServeur
}

package "Frontend Web" {
    Leaderboard
}

@enduml
